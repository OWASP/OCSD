# Module 13. API and Web Service Security

## Learning Objectives

After completing this module, developers will be able to:

- Identify and mitigate OWASP API Security Top 10 vulnerabilities
- Implement secure authentication and authorization for APIs
- Apply proper input validation and rate limiting techniques for APIs
- Secure different API types including REST, GraphQL, SOAP, and gRPC
- Implement secure webhook patterns and API gateway configurations

---

## 13.1 Security Vulnerabilities in APIs and Web Services

### OWASP API Security Top 10 (2023)

- API1:2023 - Broken Object Level Authorization (BOLA)
- API2:2023 - Broken Authentication
- API3:2023 - Broken Object Property Level Authorization
- API4:2023 - Unrestricted Resource Consumption
- API5:2023 - Broken Function Level Authorization (BFLA)
- API6:2023 - Unrestricted Access to Sensitive Business Flows
- API7:2023 - Server-Side Request Forgery (SSRF)
- API8:2023 - Security Misconfiguration
- API9:2023 - Improper Inventory Management
- API10:2023 - Unsafe Consumption of APIs

---

## 13.2 API Authentication

### OAuth 2.0

- Authorization code flow with PKCE
- Client credentials flow for service-to-service
- Token validation and verification
- Scope management and enforcement

### API Keys

- Secure key generation and storage
- Key rotation policies
- Key scope and permission limiting
- Avoiding key exposure in URLs and logs

### JWT (JSON Web Tokens)

- Token structure and validation
- Algorithm selection (RS256 vs HS256)
- Claims validation (exp, iat, iss, aud)
- Token refresh and revocation strategies
- Avoiding sensitive data in JWT payloads

---

## 13.3 API Authorization

### Object Level Authorization

- Validate user access to specific resources
- Implement consistent authorization checks
- Avoid relying on client-provided IDs without validation

### Function Level Authorization

- Role-based endpoint access
- Administrative function protection
- HTTP method restrictions per role

### Attribute-Based Access Control for APIs

- Dynamic authorization based on context
- Policy enforcement points in API gateway

---

## 13.4 Rate Limiting and Throttling

### Implementation Strategies

- Per-user rate limits
- Per-endpoint rate limits
- Global rate limits
- Sliding window vs fixed window algorithms

### Quota Management

- API usage quotas and tiers
- Burst handling
- Rate limit headers (X-RateLimit-Limit, X-RateLimit-Remaining)

### Protection Against Abuse

- Denial of Service prevention
- Credential stuffing mitigation
- Brute force protection

---

## 13.5 Input Validation for APIs

### Request Validation

- Schema validation (JSON Schema, OpenAPI)
- Content-type validation
- Size limits for request bodies
- Parameter type and format validation

### Data Sanitization

- Input encoding and escaping
- SQL injection prevention in API queries
- NoSQL injection prevention
- Command injection prevention

### Output Encoding

- Response content-type headers
- Preventing XSS in API responses
- Avoiding sensitive data in error messages

---

## 13.6 REST API Security

### Secure Design Principles

- Use proper HTTP methods (GET, POST, PUT, DELETE)
- Stateless authentication
- HTTPS enforcement
- Proper status code usage

### Security Headers

- Content-Type validation
- X-Content-Type-Options: nosniff
- Cache-Control for sensitive data
- CORS configuration

### Endpoint Security

- Versioning strategies
- Resource naming conventions
- Pagination and filtering security

---

## 13.7 GraphQL Security

### Query Security

- Query depth limiting
- Query complexity analysis
- Field-level authorization
- Introspection control in production

### Rate Limiting for GraphQL

- Query cost analysis
- Timeout enforcement
- Batch query limits

### Common GraphQL Vulnerabilities

- Denial of Service via complex queries
- Information disclosure via introspection
- Authorization bypass in resolvers

---

## 13.8 SOAP and gRPC Security

### SOAP Security

- WS-Security standards
- XML signature and encryption
- SAML token integration
- XXE prevention in XML parsing

### gRPC Security

- TLS/mTLS for transport security
- Token-based authentication
- Interceptors for authorization
- Protobuf validation

---

## 13.9 Webhook Security

### Vulnerabilities

- Clear text communication
- Missing verification of message and origin
- Replay attacks
- Missing data and schema validation
- Lack of expiry times
- SSRF via webhook URLs

### Securing Webhooks

- HTTPS enforcement
- HMAC signature verification
- Timestamp validation and replay prevention
- IP allowlisting
- Request timeout limits
- Payload schema validation

### Webhook Endpoint Security

- Authentication of webhook endpoints
- Idempotency handling
- Async processing of webhook payloads
- Error handling and retry logic

---

## 13.10 API Gateway Security

### Gateway Functions

- Centralized authentication and authorization
- Rate limiting and throttling
- Request/response transformation
- Logging and monitoring

### Security Features

- WAF integration
- Bot detection
- DDoS protection
- API versioning management

### Configuration Security

- Secure default configurations
- Certificate management
- Secret management for backend services
- Access control for gateway administration

---

## 13.11 Third-Party API Security

### Cross-Origin Resource Sharing (CORS)

- Proper origin validation
- Credential handling
- Preflight request configuration
- Avoiding wildcard origins with credentials

### Third-Party Authentication and Authorization

- Validating third-party tokens
- Scope verification
- Token storage security

### Data Validation from External APIs

- Never trust external API responses
- Schema validation of responses
- Error handling for external failures
- Timeout and circuit breaker patterns

---

## 13.12 API Security Testing

### Security Testing Approaches

- API fuzzing
- Authentication and authorization testing
- Business logic testing
- Rate limit testing

### Continuous Security

- API security in CI/CD pipelines
- Automated security scanning
- API contract testing
- Security regression testing
