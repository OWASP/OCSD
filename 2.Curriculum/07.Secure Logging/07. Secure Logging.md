# Module 7. Secure Logging

## Learning Objectives

After completing this module, developers will be able to:

- Implement comprehensive logging for security-relevant events
- Prevent log injection attacks and protect log integrity
- Design centralized logging architectures with proper retention policies
- Apply structured logging formats with correlation IDs for distributed systems

---

## 7.1 What to Log

### Security Events to Log

- Authentication events (success and failure)
- Authorization decisions (grants and denials)
- Input validation failures
- Application errors and exceptions
- Administrative actions
- Data access and modifications
- Session management events

### Assets and Resources for Logging

- APIs and web applications
- Server-side code and services
- Kubernetes and container orchestration
- Pull requests and code changes
- Activities on image registry
- Database access and queries
- File system operations

---

## 7.2 What NOT to Log

### Sensitive Data to Exclude

- Passwords and credentials
- Session tokens and API keys
- Data elements with regulatory requirements:
  - Personally Identifiable Information (PII)
  - Cardholder data (PCI DSS)
  - Protected Health Information (PHI)
- Credit card numbers
- Social security numbers
- Encryption keys and secrets

### Data Masking Techniques

- Partial masking (showing last 4 digits)
- Tokenization in logs
- Hashing for correlation without exposure
- Field-level exclusion

---

## 7.3 Log Injection Prevention

### Attack Vectors

- Newline injection for log forging
- Escape sequence injection
- Format string attacks
- Log file path traversal

### Prevention Techniques

- Input sanitization before logging
- Encoding special characters
- Using structured logging formats
- Parameterized log messages

---

## 7.4 Logging Libraries and Frameworks

### Using Logging Libraries (e.g., Log4j, SLF4J, Winston)

- Configuration best practices
- Security considerations in logging frameworks
- Version management and patching
- Avoiding vulnerable configurations

### Logging Levels

- ERROR: Security incidents and failures
- WARN: Suspicious activities
- INFO: Normal security events
- DEBUG: Detailed diagnostic (not in production)

---

## 7.5 Attributes of Events and Logs

### Essential Log Fields

- Timestamp (with timezone)
- Identity (user, service, or system)
- Action performed
- Resource affected
- Outcome (success/failure)
- Source IP address
- Request/correlation ID
- Session identifier

### Context Information

- Application and version
- Environment (prod/staging/dev)
- Server/container identifier
- Request method and path

---

## 7.6 Centralized Logging Architecture

### Architecture Components

- Log aggregation services
- Log shippers and agents
- Central log storage
- Search and analysis tools

### Benefits

- Unified view across services
- Improved incident response
- Compliance evidence collection
- Cross-service correlation

---

## 7.7 Log Integrity and Tamper Detection

### Integrity Mechanisms

- Write-once log storage
- Cryptographic log signing
- Hash chaining
- Secure timestamps

### Access Controls

- Read-only access for most users
- Separate log administration
- Audit trail for log access
- Immutable audit logs

---

## 7.8 Log Retention Policies

### Retention Considerations

- Regulatory requirements (GDPR, PCI DSS, HIPAA)
- Legal hold requirements
- Storage costs
- Investigation needs

### Implementation

- Automated log rotation
- Archival to cold storage
- Secure log deletion
- Retention period enforcement

---

## 7.9 SIEM Integration

### Integration Points

- Real-time log streaming
- Alert generation
- Correlation rules
- Incident response workflows

### Security Monitoring

- Anomaly detection
- Threat intelligence integration
- Behavioral analysis
- Compliance dashboards

---

## 7.10 Structured Logging Formats

### JSON Logging

- Consistent field naming
- Nested object support
- Machine-readable format
- Easy parsing and indexing

### Log Schema Standards

- Common Event Format (CEF)
- Log Event Extended Format (LEEF)
- Elastic Common Schema (ECS)
- OpenTelemetry logging

---

## 7.11 Correlation IDs for Distributed Tracing

### Implementation

- Generate unique IDs at entry point
- Propagate through all services
- Include in all log messages
- Pass through async operations

### Benefits

- End-to-end request tracking
- Distributed debugging
- Performance analysis
- Security incident investigation
